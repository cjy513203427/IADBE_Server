/bin/bash /home/jinyao/PycharmProjects/IADBE/train_test_btech_cfa.sh
(IADBE) jinyao@jinyao-System-Product-Name:~/PycharmProjects/IADBE$ /bin/bash /home/jinyao/PycharmProjects/IADBE/train_test_btech_cfa.sh
Running command: anomalib train --data anomalib.data.BTech --data.category 01 --config ./configs/models/cfa.yaml
2024-06-25 14:10:01,205 - anomalib.utils.config - WARNING - Anomalib currently does not support multi-gpu training. Setting devices to 1.
[06/25/24 14:10:01] WARNING  Anomalib currently does not support multi-gpu training. Setting devices to 1.                                                                                                    config.py:262
2024-06-25 14:10:01,222 - anomalib.models.components.base.anomaly_module - INFO - Initializing Cfa model.
                    INFO     Initializing Cfa model.                                                                                                                                                   anomaly_module.py:42
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=Wide_ResNet50_2_Weights.IMAGENET1K_V1`. You can also use `weights=Wide_ResNet50_2_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:110: UserWarning: 'has_cuda' is deprecated, please use 'torch.backends.cuda.is_built()'
  torch.has_cuda,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:111: UserWarning: 'has_cudnn' is deprecated, please use 'torch.backends.cudnn.is_available()'
  torch.has_cudnn,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:117: UserWarning: 'has_mps' is deprecated, please use 'torch.backends.mps.is_built()'
  torch.has_mps,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:118: UserWarning: 'has_mkldnn' is deprecated, please use 'torch.backends.mkldnn.is_available()'
  torch.has_mkldnn,
2024-06-25 14:10:02,071 - anomalib.callbacks - INFO - Loading the callbacks
[06/25/24 14:10:02] INFO     Loading the callbacks                                                                                                                                                           __init__.py:43
2024-06-25 14:10:02,073 - anomalib.engine.engine - INFO - Overriding gradient_clip_val from None with 0 for Cfa
                    INFO     Overriding gradient_clip_val from None with 0 for Cfa                                                                                                                             engine.py:84
2024-06-25 14:10:02,074 - anomalib.engine.engine - INFO - Overriding num_sanity_val_steps from None with 0 for Cfa
                    INFO     Overriding num_sanity_val_steps from None with 0 for Cfa                                                                                                                          engine.py:84
2024-06-25 14:10:02,155 - lightning.pytorch.utilities.rank_zero - INFO - Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[06/25/24 14:10:02] INFO     Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default               rank_zero.py:63
                             `ModelSummary` callback.
2024-06-25 14:10:02,163 - lightning.pytorch.utilities.rank_zero - INFO - GPU available: True (cuda), used: True
                    INFO     GPU available: True (cuda), used: True                                                                                                                                         rank_zero.py:63
2024-06-25 14:10:02,164 - lightning.pytorch.utilities.rank_zero - INFO - TPU available: False, using: 0 TPU cores
                    INFO     TPU available: False, using: 0 TPU cores                                                                                                                                       rank_zero.py:63
2024-06-25 14:10:02,165 - lightning.pytorch.utilities.rank_zero - INFO - IPU available: False, using: 0 IPUs
                    INFO     IPU available: False, using: 0 IPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:10:02,166 - lightning.pytorch.utilities.rank_zero - INFO - HPU available: False, using: 0 HPUs
                    INFO     HPU available: False, using: 0 HPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:10:02,166 - anomalib.models.components.base.anomaly_module - WARNING - No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use case. Please override `configure_transforms` in your model.
                    WARNING  No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use     anomaly_module.py:235
                             case. Please override `configure_transforms` in your model.
2024-06-25 14:10:02,168 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:10:02,214 - lightning.pytorch.utilities.rank_zero - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
                    INFO     You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' |         rank_zero.py:63
                             'high')` which will trade-off precision for performance. For more details, read
                             https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2024-06-25 14:10:02,391 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
                    INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
┏━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃   ┃ Name                  ┃ Type                     ┃ Params ┃
┡━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0 │ model                 │ CfaModel                 │ 31.3 M │
│ 1 │ loss                  │ CfaLoss                  │      0 │
│ 2 │ _transform            │ Compose                  │      0 │
│ 3 │ normalization_metrics │ MinMax                   │      0 │
│ 4 │ image_threshold       │ F1AdaptiveThreshold      │      0 │
│ 5 │ pixel_threshold       │ F1AdaptiveThreshold      │      0 │
│ 6 │ image_metrics         │ AnomalibMetricCollection │      0 │
│ 7 │ pixel_metrics         │ AnomalibMetricCollection │      0 │
└───┴───────────────────────┴──────────────────────────┴────────┘
Trainable params: 31.3 M
Non-trainable params: 0
Total params: 31.3 M
Total estimated model params size (MB): 125
  0%|                                                                                                                                                                                               | 0/13 [00:00<?, ?it/s]
  8%|##############                                                                                                                                                                         | 1/13 [00:16<03:23, 16.93s/it]
 15%|############################1                                                                                                                                                          | 2/13 [00:17<01:17,  7.04s/it]
 23%|##########################################2                                                                                                                                            | 3/13 [00:17<00:38,  3.89s/it]
 31%|########################################################3                                                                                                                              | 4/13 [00:17<00:21,  2.40s/it]
 38%|######################################################################3                                                                                                                | 5/13 [00:17<00:12,  1.58s/it]
 46%|####################################################################################4                                                                                                  | 6/13 [00:17<00:07,  1.09s/it]
 54%|##################################################################################################5                                                                                    | 7/13 [00:17<00:04,  1.29it/s]
 62%|################################################################################################################6                                                                      | 8/13 [00:17<00:02,  1.74it/s]
 69%|##############################################################################################################################6                                                        | 9/13 [00:24<00:09,  2.41s/it]
 77%|############################################################################################################################################                                          | 10/13 [00:24<00:05,  1.71s/it]
 85%|##########################################################################################################################################################                            | 11/13 [00:24<00:02,  1.25s/it]
 92%|########################################################################################################################################################################              | 12/13 [00:24<00:00,  1.11it/s]
100%|######################################################################################################################################################################################| 13/13 [00:24<00:00,  1.51it/s]
100%|######################################################################################################################################################################################| 13/13 [00:24<00:00,  1.92s/it]

Epoch 5/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13/13 0:00:12 • 0:00:00 1.80it/s pixel_AUROC: 0.516 pixel_PRO: 0.0002024-06-25 14:12:09,173 - anomalib.callbacks.timer - INFO - Training took 126.77 seconds
[06/25/24 14:12:09] INFO     Training took 126.77 seconds                                                                                                                                                       timer.py:59
Epoch 5/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13/13 0:00:12 • 0:00:00 1.80it/s pixel_AUROC: 0.516 pixel_PRO: 0.000
2024-06-25 14:12:09,177 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:12:09,233 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[06/25/24 14:12:09] INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/anomalib/utils/post_processing.py:89: RuntimeWarning: invalid value encountered in cast
  anomaly_map = anomaly_map.astype(np.uint8)
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3/3 0:00:12 • 0:00:00 0.16it/s  2024-06-25 14:12:27,228 - anomalib.callbacks.timer - INFO - Testing took 17.753276109695435 seconds
Throughput (batch_size=32) : 3.942934226194541 FPS
[06/25/24 14:12:27] INFO     Testing took 17.753276109695435 seconds                                                                                                                                           timer.py:109
                             Throughput (batch_size=32) : 3.942934226194541 FPS
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│        image_AUROC        │    0.21768707036972046    │
│         image_PRO         │            1.0            │
│        pixel_AUROC        │     0.51569664478302      │
│         pixel_PRO         │            0.0            │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 3/3 0:00:12 • 0:00:00 0.16it/s
Running command: anomalib train --data anomalib.data.BTech --data.category 02 --config ./configs/models/cfa.yaml
2024-06-25 14:12:32,896 - anomalib.utils.config - WARNING - Anomalib currently does not support multi-gpu training. Setting devices to 1.
[06/25/24 14:12:32] WARNING  Anomalib currently does not support multi-gpu training. Setting devices to 1.                                                                                                    config.py:262
2024-06-25 14:12:32,912 - anomalib.models.components.base.anomaly_module - INFO - Initializing Cfa model.
                    INFO     Initializing Cfa model.                                                                                                                                                   anomaly_module.py:42
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=Wide_ResNet50_2_Weights.IMAGENET1K_V1`. You can also use `weights=Wide_ResNet50_2_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:110: UserWarning: 'has_cuda' is deprecated, please use 'torch.backends.cuda.is_built()'
  torch.has_cuda,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:111: UserWarning: 'has_cudnn' is deprecated, please use 'torch.backends.cudnn.is_available()'
  torch.has_cudnn,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:117: UserWarning: 'has_mps' is deprecated, please use 'torch.backends.mps.is_built()'
  torch.has_mps,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:118: UserWarning: 'has_mkldnn' is deprecated, please use 'torch.backends.mkldnn.is_available()'
  torch.has_mkldnn,
2024-06-25 14:12:33,724 - anomalib.callbacks - INFO - Loading the callbacks
[06/25/24 14:12:33] INFO     Loading the callbacks                                                                                                                                                           __init__.py:43
2024-06-25 14:12:33,726 - anomalib.engine.engine - INFO - Overriding gradient_clip_val from None with 0 for Cfa
                    INFO     Overriding gradient_clip_val from None with 0 for Cfa                                                                                                                             engine.py:84
2024-06-25 14:12:33,727 - anomalib.engine.engine - INFO - Overriding num_sanity_val_steps from None with 0 for Cfa
                    INFO     Overriding num_sanity_val_steps from None with 0 for Cfa                                                                                                                          engine.py:84
2024-06-25 14:12:33,807 - lightning.pytorch.utilities.rank_zero - INFO - Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[06/25/24 14:12:33] INFO     Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default               rank_zero.py:63
                             `ModelSummary` callback.
2024-06-25 14:12:33,815 - lightning.pytorch.utilities.rank_zero - INFO - GPU available: True (cuda), used: True
                    INFO     GPU available: True (cuda), used: True                                                                                                                                         rank_zero.py:63
2024-06-25 14:12:33,816 - lightning.pytorch.utilities.rank_zero - INFO - TPU available: False, using: 0 TPU cores
                    INFO     TPU available: False, using: 0 TPU cores                                                                                                                                       rank_zero.py:63
2024-06-25 14:12:33,817 - lightning.pytorch.utilities.rank_zero - INFO - IPU available: False, using: 0 IPUs
                    INFO     IPU available: False, using: 0 IPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:12:33,817 - lightning.pytorch.utilities.rank_zero - INFO - HPU available: False, using: 0 HPUs
                    INFO     HPU available: False, using: 0 HPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:12:33,818 - anomalib.models.components.base.anomaly_module - WARNING - No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use case. Please override `configure_transforms` in your model.
                    WARNING  No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use     anomaly_module.py:235
                             case. Please override `configure_transforms` in your model.
2024-06-25 14:12:33,819 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:12:33,857 - lightning.pytorch.utilities.rank_zero - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
                    INFO     You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' |         rank_zero.py:63
                             'high')` which will trade-off precision for performance. For more details, read
                             https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2024-06-25 14:12:34,046 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[06/25/24 14:12:34] INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
┏━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃   ┃ Name                  ┃ Type                     ┃ Params ┃
┡━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0 │ model                 │ CfaModel                 │ 31.3 M │
│ 1 │ loss                  │ CfaLoss                  │      0 │
│ 2 │ _transform            │ Compose                  │      0 │
│ 3 │ normalization_metrics │ MinMax                   │      0 │
│ 4 │ image_threshold       │ F1AdaptiveThreshold      │      0 │
│ 5 │ pixel_threshold       │ F1AdaptiveThreshold      │      0 │
│ 6 │ image_metrics         │ AnomalibMetricCollection │      0 │
│ 7 │ pixel_metrics         │ AnomalibMetricCollection │      0 │
└───┴───────────────────────┴──────────────────────────┴────────┘
Trainable params: 31.3 M
Non-trainable params: 0
Total params: 31.3 M
Total estimated model params size (MB): 125
  0%|                                                                                                                                                                                               | 0/13 [00:00<?, ?it/s]
  8%|##############                                                                                                                                                                         | 1/13 [00:02<00:25,  2.15s/it]
 23%|##########################################2                                                                                                                                            | 3/13 [00:02<00:06,  1.58it/s]
 31%|########################################################3                                                                                                                              | 4/13 [00:02<00:04,  2.20it/s]
 38%|######################################################################3                                                                                                                | 5/13 [00:02<00:02,  2.93it/s]
 46%|####################################################################################4                                                                                                  | 6/13 [00:02<00:01,  3.73it/s]
 54%|##################################################################################################5                                                                                    | 7/13 [00:02<00:01,  4.57it/s]
 62%|################################################################################################################6                                                                      | 8/13 [00:02<00:00,  5.39it/s]
 69%|##############################################################################################################################6                                                        | 9/13 [00:03<00:00,  6.13it/s]
 77%|############################################################################################################################################                                          | 10/13 [00:03<00:00,  6.77it/s]
 85%|##########################################################################################################################################################                            | 11/13 [00:03<00:00,  7.28it/s]
 92%|########################################################################################################################################################################              | 12/13 [00:03<00:00,  7.69it/s]
100%|######################################################################################################################################################################################| 13/13 [00:03<00:00,  8.16it/s]
100%|######################################################################################################################################################################################| 13/13 [00:03<00:00,  3.69it/s]

Epoch 7/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13/13 0:00:05 • 0:00:00 2.58it/s pixel_AUROC: 0.929 pixel_PRO: 0.3602024-06-25 14:14:26,605 - anomalib.callbacks.timer - INFO - Training took 112.55 seconds
[06/25/24 14:14:26] INFO     Training took 112.55 seconds                                                                                                                                                       timer.py:59
Epoch 7/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13/13 0:00:05 • 0:00:00 2.58it/s pixel_AUROC: 0.936 pixel_PRO: 0.354
2024-06-25 14:14:26,608 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:14:26,687 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[06/25/24 14:14:26] INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 8/8 0:00:31 • 0:00:00 0.22it/s  2024-06-25 14:15:02,918 - anomalib.callbacks.timer - INFO - Testing took 35.91139888763428 seconds
Throughput (batch_size=32) : 6.404651646115577 FPS
[06/25/24 14:15:02] INFO     Testing took 35.91139888763428 seconds                                                                                                                                            timer.py:109
                             Throughput (batch_size=32) : 6.404651646115577 FPS
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│        image_AUROC        │    0.7689999938011169     │
│         image_PRO         │            1.0            │
│        pixel_AUROC        │    0.9550209045410156     │
│         pixel_PRO         │    0.3544090986251831     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 8/8 0:00:31 • 0:00:00 0.22it/s
Running command: anomalib train --data anomalib.data.BTech --data.category 03 --config ./configs/models/cfa.yaml
2024-06-25 14:15:08,732 - anomalib.utils.config - WARNING - Anomalib currently does not support multi-gpu training. Setting devices to 1.
[06/25/24 14:15:08] WARNING  Anomalib currently does not support multi-gpu training. Setting devices to 1.                                                                                                    config.py:262
2024-06-25 14:15:08,748 - anomalib.models.components.base.anomaly_module - INFO - Initializing Cfa model.
                    INFO     Initializing Cfa model.                                                                                                                                                   anomaly_module.py:42
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:208: UserWarning: The parameter 'pretrained' is deprecated since 0.13 and may be removed in the future, please use 'weights' instead.
  warnings.warn(
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torchvision/models/_utils.py:223: UserWarning: Arguments other than a weight enum or `None` for 'weights' are deprecated since 0.13 and may be removed in the future. The current behavior is equivalent to passing `weights=Wide_ResNet50_2_Weights.IMAGENET1K_V1`. You can also use `weights=Wide_ResNet50_2_Weights.DEFAULT` to get the most up-to-date weights.
  warnings.warn(msg)
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:110: UserWarning: 'has_cuda' is deprecated, please use 'torch.backends.cuda.is_built()'
  torch.has_cuda,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:111: UserWarning: 'has_cudnn' is deprecated, please use 'torch.backends.cudnn.is_available()'
  torch.has_cudnn,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:117: UserWarning: 'has_mps' is deprecated, please use 'torch.backends.mps.is_built()'
  torch.has_mps,
/home/jinyao/anaconda3/envs/IADBE/lib/python3.10/site-packages/torch/overrides.py:118: UserWarning: 'has_mkldnn' is deprecated, please use 'torch.backends.mkldnn.is_available()'
  torch.has_mkldnn,
2024-06-25 14:15:09,562 - anomalib.callbacks - INFO - Loading the callbacks
[06/25/24 14:15:09] INFO     Loading the callbacks                                                                                                                                                           __init__.py:43
2024-06-25 14:15:09,563 - anomalib.engine.engine - INFO - Overriding gradient_clip_val from None with 0 for Cfa
                    INFO     Overriding gradient_clip_val from None with 0 for Cfa                                                                                                                             engine.py:84
2024-06-25 14:15:09,564 - anomalib.engine.engine - INFO - Overriding num_sanity_val_steps from None with 0 for Cfa
                    INFO     Overriding num_sanity_val_steps from None with 0 for Cfa                                                                                                                          engine.py:84
2024-06-25 14:15:09,648 - lightning.pytorch.utilities.rank_zero - INFO - Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.
[06/25/24 14:15:09] INFO     Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default               rank_zero.py:63
                             `ModelSummary` callback.
2024-06-25 14:15:09,656 - lightning.pytorch.utilities.rank_zero - INFO - GPU available: True (cuda), used: True
                    INFO     GPU available: True (cuda), used: True                                                                                                                                         rank_zero.py:63
2024-06-25 14:15:09,657 - lightning.pytorch.utilities.rank_zero - INFO - TPU available: False, using: 0 TPU cores
                    INFO     TPU available: False, using: 0 TPU cores                                                                                                                                       rank_zero.py:63
2024-06-25 14:15:09,658 - lightning.pytorch.utilities.rank_zero - INFO - IPU available: False, using: 0 IPUs
                    INFO     IPU available: False, using: 0 IPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:15:09,659 - lightning.pytorch.utilities.rank_zero - INFO - HPU available: False, using: 0 HPUs
                    INFO     HPU available: False, using: 0 HPUs                                                                                                                                            rank_zero.py:63
2024-06-25 14:15:09,659 - anomalib.models.components.base.anomaly_module - WARNING - No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use case. Please override `configure_transforms` in your model.
                    WARNING  No implementation of `configure_transforms` was provided in the Lightning model. Using default transforms from the base class. This may not be suitable for your use     anomaly_module.py:235
                             case. Please override `configure_transforms` in your model.
2024-06-25 14:15:09,661 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:15:09,697 - lightning.pytorch.utilities.rank_zero - INFO - You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
                    INFO     You are using a CUDA device ('NVIDIA GeForce RTX 3090') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' |         rank_zero.py:63
                             'high')` which will trade-off precision for performance. For more details, read
                             https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
2024-06-25 14:15:09,914 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
                    INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
┏━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓
┃   ┃ Name                  ┃ Type                     ┃ Params ┃
┡━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩
│ 0 │ model                 │ CfaModel                 │ 31.3 M │
│ 1 │ loss                  │ CfaLoss                  │      0 │
│ 2 │ _transform            │ Compose                  │      0 │
│ 3 │ normalization_metrics │ MinMax                   │      0 │
│ 4 │ image_threshold       │ F1AdaptiveThreshold      │      0 │
│ 5 │ pixel_threshold       │ F1AdaptiveThreshold      │      0 │
│ 6 │ image_metrics         │ AnomalibMetricCollection │      0 │
│ 7 │ pixel_metrics         │ AnomalibMetricCollection │      0 │
└───┴───────────────────────┴──────────────────────────┴────────┘
Trainable params: 31.3 M
Non-trainable params: 0
Total params: 31.3 M
Total estimated model params size (MB): 125
  0%|                                                                                                                                                                                               | 0/32 [00:00<?, ?it/s]
  3%|#####7                                                                                                                                                                                 | 1/32 [00:03<01:34,  3.06s/it]
  6%|###########4                                                                                                                                                                           | 2/32 [00:03<00:40,  1.36s/it]
  9%|#################1                                                                                                                                                                     | 3/32 [00:03<00:23,  1.24it/s]
 12%|######################8                                                                                                                                                                | 4/32 [00:03<00:15,  1.82it/s]
 16%|############################5                                                                                                                                                          | 5/32 [00:03<00:10,  2.46it/s]
 19%|##################################3                                                                                                                                                    | 6/32 [00:03<00:08,  3.16it/s]
 22%|########################################                                                                                                                                               | 7/32 [00:03<00:06,  3.90it/s]
 25%|#############################################7                                                                                                                                         | 8/32 [00:04<00:05,  4.69it/s]
 28%|###################################################4                                                                                                                                   | 9/32 [00:04<00:04,  5.43it/s]
 31%|########################################################8                                                                                                                             | 10/32 [00:04<00:03,  6.05it/s]
 34%|##############################################################5                                                                                                                       | 11/32 [00:04<00:03,  6.50it/s]
 38%|####################################################################2                                                                                                                 | 12/32 [00:04<00:02,  6.94it/s]
 41%|#########################################################################9                                                                                                            | 13/32 [00:04<00:02,  7.32it/s]
 44%|###############################################################################6                                                                                                      | 14/32 [00:04<00:02,  7.59it/s]
 47%|#####################################################################################3                                                                                                | 15/32 [00:04<00:02,  7.74it/s]
 50%|###########################################################################################                                                                                           | 16/32 [00:05<00:02,  7.94it/s]
 53%|################################################################################################6                                                                                     | 17/32 [00:05<00:01,  7.96it/s]
 56%|######################################################################################################3                                                                               | 18/32 [00:05<00:01,  8.22it/s]
 59%|############################################################################################################                                                                          | 19/32 [00:05<00:01,  8.42it/s]
 62%|#################################################################################################################7                                                                    | 20/32 [00:05<00:01,  8.58it/s]
 66%|#######################################################################################################################4                                                              | 21/32 [00:05<00:01,  8.72it/s]
 69%|#############################################################################################################################1                                                        | 22/32 [00:05<00:01,  8.82it/s]
 72%|##################################################################################################################################8                                                   | 23/32 [00:05<00:01,  8.87it/s]
 75%|########################################################################################################################################5                                             | 24/32 [00:05<00:00,  8.64it/s]
 78%|##############################################################################################################################################1                                       | 25/32 [00:06<00:00,  8.71it/s]
 81%|###################################################################################################################################################8                                  | 26/32 [00:06<00:00,  8.78it/s]
 84%|#########################################################################################################################################################5                            | 27/32 [00:06<00:00,  8.86it/s]
 88%|###############################################################################################################################################################2                      | 28/32 [00:06<00:00,  9.01it/s]
 91%|####################################################################################################################################################################9                 | 29/32 [00:06<00:00,  9.13it/s]
 94%|##########################################################################################################################################################################6           | 30/32 [00:06<00:00,  9.15it/s]
 97%|################################################################################################################################################################################3     | 31/32 [00:06<00:00,  9.20it/s]
100%|######################################################################################################################################################################################| 32/32 [00:06<00:00,  4.66it/s]

Epoch 8/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 32/32 0:00:12 • 0:00:00 2.64it/s pixel_AUROC: 0.995 pixel_PRO: 0.4032024-06-25 14:19:29,597 - anomalib.callbacks.timer - INFO - Training took 259.67 seconds
[06/25/24 14:19:29] INFO     Training took 259.67 seconds                                                                                                                                                       timer.py:59
Epoch 8/29 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 32/32 0:00:12 • 0:00:00 2.64it/s pixel_AUROC: 0.995 pixel_PRO: 0.408
2024-06-25 14:19:29,603 - anomalib.data.image.btech - INFO - Found the dataset.
                    INFO     Found the dataset.                                                                                                                                                                btech.py:351
2024-06-25 14:19:29,700 - lightning.pytorch.accelerators.cuda - INFO - LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
[06/25/24 14:19:29] INFO     LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]                                                                                                                                           cuda.py:58
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 14/14 0:00:56 • 0:00:00 0.23it/s  2024-06-25 14:20:36,334 - anomalib.callbacks.timer - INFO - Testing took 66.28288102149963 seconds
Throughput (batch_size=32) : 6.653301624848751 FPS
[06/25/24 14:20:36] INFO     Testing took 66.28288102149963 seconds                                                                                                                                            timer.py:109
                             Throughput (batch_size=32) : 6.653301624848751 FPS
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃        Test metric        ┃       DataLoader 0        ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│        image_AUROC        │    0.9912804961204529     │
│         image_PRO         │            1.0            │
│        pixel_AUROC        │    0.9951595664024353     │
│         pixel_PRO         │    0.4080272316932678     │
└───────────────────────────┴───────────────────────────┘
Testing ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 14/14 0:00:56 • 0:00:00 0.23it/s
